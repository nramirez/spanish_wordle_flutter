import 'package:flutter/material.dart';
import 'package:toast/toast.dart';

import 'models/letter.dart';
import 'db.dart';

List<String> get dictionary => [
      "ellos",
      "tener",
      "desde",
      "usted",
      "fuera",
      "otros",
      "hacer",
      "dicho",
      "decir",
      "jugar",
      "poner",
      "punto",
      "madre",
      "mundo",
      "cerca",
      "padre",
      "nuevo",
      "parte",
      "tomar",
      "lugar",
      "hecho",
      "vivir",
      "donde",
      "ronda",
      "buena",
      "forma",
      "frase",
      "linea",
      "causa",
      "mucho",
      "antes",
      "viejo",
      "misma",
      "hasta",
      "haria",
      "estos",
      "largo",
      "tiene",
      "podia",
      "venir",
      "sonar",
      "sobre",
      "saber",
      "puede",
      "abajo",
      "ahora",
      "entre",
      "nunca",
      "dejar",
      "arbol",
      "tarde",
      "noche",
      "pocos",
      "norte",
      "libro",
      "comer",
      "amigo",
      "gusta",
      "peces",
      "papel",
      "grupo",
      "ambos",
      "marca",
      "carta",
      "milla",
      "coche",
      "llano",
      "chica",
      "joven",
      "listo",
      "lista",
      "perro",
      "medir",
      "negro",
      "corto",
      "clase",
      "buque",
      "medio",
      "orden",
      "fuego",
      "pieza",
      "sabia",
      "pasar",
      "calle",
      "curso",
      "rueda",
      "barco",
      "comun",
      "plano",
      "juego",
      "calor",
      "nieve",
      "traer",
      "volar",
      "grito",
      "campo",
      "resto",
      "capaz",
      "libra",
      "verde",
      "libre",
      "mente",
      "claro",
      "mejor",
      "horas",
      "cinco",
      "oeste",
      "suelo",
      "verbo",
      "menos",
      "vocal",
      "hacia",
      "lenta",
      "regla",
      "Halar",
      "aviso",
      "huevo",
      "paseo",
      "creer",
      "plaza",
      "razon",
      "hielo",
      "danza",
      "motor",
      "brazo",
      "pared",
      "monte",
      "cielo",
      "bordo",
      "borde",
      "signo",
      "suave",
      "feliz",
      "viaje",
      "morir",
      "patio",
      "golpe",
      "tocar",
      "costo",
      "igual",
      "fluir",
      "justo",
      "banco",
      "demas",
      "matar",
      "recta",
      "leche",
      "pagar",
      "pobre",
      "clave",
      "plana",
      "siete",
      "siglo",
      "costa",
      "copia",
      "arena",
      "rollo",
      "valor",
      "lucha",
      "batir",
      "vista",
      "silla",
      "fruta",
      "Radio",
      "hablo",
      "atomo",
      "hueso",
      "mujer",
      "agudo",
      "crear",
      "poema",
      "carne",
      "dolar",
      "miedo",
      "prisa",
      "reloj",
      "print",
      "traje",
      "pista",
      "grasa",
      "cuota",
      "barra",
      "grado",
      "apoyo",
      "vapor",
      "plata",
      "acero",
      "guiar",
      "pitch",
      "banda",
      "ganar",
      "valle",
      "doble",
      "tabla",
      "exito",
      "nadar",
      "plazo",
      "nueve",
      "ruido",
      "nivel",
      "tramo",
      "nariz",
      "habia",
      "todos",
      "mismo",
      "tanto",
      "segun",
      "estos",
      "mayor",
      "quien",
      "estan",
      "otras",
      "todas",
      "luego",
      "estas",
      "tenia",
      "poder",
      "veces",
      "nueva",
      "cosas",
      "haber",
      "nadie",
      "estar",
      "gente",
      "final",
      "meses",
      "maria",
      "seria",
      "junto",
      "aquel",
      "casos",
      "manos",
      "falta",
      "hemos",
      "trata",
      "algun",
      "ellas",
      "total",
      "tengo",
      "unico",
      "pesar",
      "obras",
      "estoy",
      "quien",
      "fondo",
      "salud",
      "media",
      "deben",
      "datos",
      "julio",
      "visto",
      "llego",
      "bueno",
      "hacia",
      "sigue",
      "serie",
      "hijos",
      "epoca",
      "menor",
      "queda",
      "hacen",
      "vamos",
      "civil",
      "pedro",
      "salir",
      "union",
      "favor",
      "color",
      "decia",
      "quiza",
      "unica",
      "pueda",
      "lleva",
      "ayuda",
      "donde",
      "autor",
      "cargo",
      "viene",
      "radio",
      "puedo",
      "habra",
      "santa",
      "quedo",
      "texto",
      "mitad",
      "fecha",
      "seran",
      "ideas",
      "llega",
      "lejos",
      "facil",
      "enero",
      "atras",
      "chile",
      "local",
      "habla",
      "tales",
      "paris",
      "podra",
      "dolor",
      "zonas",
      "temas",
      "junio",
      "marco",
      "mucha",
      "dicen",
      "busca",
      "abril",
      "lopez",
      "armas",
      "debia",
      "llama",
      "jorge",
      "corte",
      "etapa",
      "tipos",
      "deseo",
      "marzo",
      "jamas",
      "pablo",
      "larga",
      "lider",
      "torno",
      "somos",
      "ambas",
      "perez",
      "casas",
      "leyes",
      "jesus",
      "grave",
      "tenga",
      "lunes",
      "junta",
      "sitio",
      "clara",
      "moral",
      "gusto",
      "hotel",
      "salio",
      "estas",
      "venta",
      "ramon",
      "aires",
      "aguas",
      "dicha",
      "llevo",
      "tarea",
      "dando",
      "suele",
      "miles",
      "ritmo",
      "pasos",
      "pesos",
      "gesto",
      "vasco",
      "gomez",
      "pocas",
      "pidio",
      "fines",
      "labor",
      "actos",
      "museo",
      "sabes",
      "areas",
      "santo",
      "vieja",
      "mario",
      "reina",
      "salvo",
      "quiso",
      "acaba",
      "pleno",
      "acaso",
      "error",
      "seres",
      "poeta",
      "altos",
      "hojas",
      "darle",
      "votos",
      "logro",
      "sirve",
      "deuda",
      "tanta",
      "breve",
      "firma",
      "jaime",
      "canal",
      "conde",
      "carga",
      "reyes",
      "abrir",
      "cuyos",
      "negra",
      "caida",
      "bases",
      "culpa",
      "entra",
      "hayan",
      "diego",
      "actor",
      "sacar",
      "murio",
      "estas",
      "saben",
      "david",
      "salon",
      "cifra",
      "bolsa",
      "fuese",
      "serio",
      "reino",
      "plena",
      "venia",
      "aznar",
      "legal",
      "abrio",
      "china",
      "dedos",
      "voces",
      "angel",
      "temor",
      "penso",
      "dudas",
      "lleno",
      "vacio",
      "ciclo",
      "llamo",
      "pecho",
      "honor",
      "pedir",
      "mirar",
      "clima",
      "punta",
      "posee",
      "entro",
      "pacto",
      "penal",
      "llena",
      "angel",
      "disco",
      "ideal",
      "artes",
      "villa",
      "miami",
      "basta",
      "avion",
      "cuyas",
      "humor",
      "darse",
      "ganas",
      "dosis",
      "altas",
      "viven",
      "debio",
      "hogar",
      "firme",
      "exige",
      "polvo",
      "luces",
      "virus",
      "nacio",
      "animo",
      "cesar",
      "gasto",
      "pausa",
      "esten",
      "playa",
      "horno",
      "japon",
      "anual",
      "norma",
      "tomas",
      "dulce",
      "mando",
      "unido",
      "acabo",
      "solar",
      "tesis",
      "toros",
      "ocupa",
      "corta",
      "dejan",
      "vemos",
      "oscar",
      "marta",
      "modos",
      "desea",
      "pasan",
      "vuelo",
      "chico",
      "conto",
      "feria",
      "verse",
      "hecha",
      "ponen",
      "rojas",
      "rumbo",
      "trato",
      "pense",
      "creia",
      "metro",
      "creen",
      "bajar",
      "rusia",
      "vidas",
      "subir",
      "droga",
      "bajas",
      "jefes",
      "vivia",
      "elena",
      "notas",
      "fotos",
      "masas",
      "arroz",
      "islas",
      "goles",
      "fruto",
      "torre",
      "salas",
      "vital",
      "sabor",
      "tasas",
      "dieta",
      "andar",
      "pilar",
      "rival",
      "techo",
      "diria",
      "ricos",
      "salsa",
      "amiga",
      "vivos",
      "fidel",
      "india",
      "bajos",
      "malos",
      "rural",
      "letra",
      "logra",
      "opera",
      "acido",
      "banca",
      "canto",
      "debil",
      "plato",
      "etica",
      "salen",
      "pujol",
      "salto",
      "moscu",
      "bomba",
      "surge",
      "oreja",
      "xviii",
      "calma",
      "baile",
      "queso",
      "mueve",
      "euros",
      "coste",
      "kilos",
      "rigor",
      "ponia",
      "cerro",
      "palma",
      "turno",
      "deber",
      "ramas",
      "lento",
      "beber",
      "actua",
      "senti",
      "salia",
      "caido",
      "corre",
      "juega",
      "trato",
      "vigor",
      "redes",
      "venga",
      "hagan",
      "bella",
      "daban",
      "sufre",
      "luisa",
      "limon",
      "crees",
      "renta",
      "prima",
      "cajas",
      "novia",
      "caras",
      "verlo",
      "lados",
      "rubio",
      "echar",
      "quede",
      "suiza",
      "socio",
      "piano",
      "leido",
      "prado",
      "halla",
      "jordi",
      "menem",
      "parar",
      "unida",
      "irene",
      "nubes",
      "dices",
      "lanzo",
      "pesca",
      "solos",
      "selva",
      "falso",
      "aquel",
      "chino",
      "adios",
      "suyos",
      "culto",
      "guion",
      "niega",
      "envio",
      "crema",
      "situa",
      "filas",
      "balon",
      "muere",
      "hijas",
      "lucia",
      "ramos",
      "felix",
      "laura",
      "malas",
      "vivio",
      "arias",
      "pagos",
      "caldo",
      "serlo",
      "quito",
      "rayos",
      "josep",
      "ancho",
      "aerea",
      "duque",
      "genes",
      "piden",
      "sofia",
      "trece",
      "penas",
      "viuda",
      "mesas",
      "fallo",
      "primo",
      "suena",
      "grito",
      "toman",
      "preve",
      "colon",
      "crece",
      "heroe",
      "rocas",
      "llave",
      "haces",
      "ajeno",
      "drama",
      "rango",
      "toque",
      "solas",
      "subio",
      "juana",
      "solia",
      "minas",
      "lanza",
      "rojos",
      "fases",
      "arabe",
      "falsa",
      "james",
      "verla",
      "metal",
      "reves",
      "ortiz",
      "silva",
      "evita",
      "ruben",
      "fraga",
      "nacer",
      "seria",
      "indio",
      "pasta",
      "parto",
      "filme",
      "pollo",
      "duras",
      "noble",
      "bello",
      "vidal",
      "pelea",
      "rabia",
      "cinta",
      "muros",
      "barro",
      "cadiz",
      "haran",
      "ponga",
      "carro",
      "flujo",
      "duros",
      "tumba",
      "diana",
      "presa",
      "apoya",
      "video",
      "volvi",
      "movil",
      "trama",
      "tenis",
      "vayan",
      "llevo",
      "creyo",
      "sexto",
      "bahia",
      "vinos",
      "rosas",
      "trajo",
      "cobre",
      "oliva",
      "patas",
      "novio",
      "justa",
      "barba",
      "genio",
      "curva",
      "trate",
      "diera",
      "viena",
      "cable",
      "ciego",
      "abuso",
      "cuero",
      "cerro",
      "bravo",
      "lucas",
      "negar",
      "notar",
      "vimos",
      "oidos",
      "julia",
      "ojala",
      "quita",
      "serra",
      "finca",
      "gordo",
      "vasos",
      "trigo",
      "preso",
      "pedia",
      "acusa",
      "mando",
      "opera",
      "peter",
      "sudor",
      "riego",
      "sento",
      "simon",
      "hueco",
      "citar",
      "monto",
      "acuso",
      "asilo",
      "nieto",
      "falla",
      "magia",
      "flota",
      "broma",
      "copas",
      "ajena",
      "meter",
      "vasca",
      "votar",
      "cubre",
      "pisos",
      "video",
      "cerdo",
      "capas",
      "crudo",
      "press",
      "logro",
      "rodea",
      "quise",
      "miran",
      "milan",
      "mateo",
      "metio",
      "boton",
      "censo",
      "daria",
      "calvo",
      "veian",
      "golfo",
      "males",
      "maria",
      "tiros",
      "obvio",
      "peron",
      "mover",
      "duelo",
      "fijar",
      "busco",
      "reune",
      "damas",
      "lecho",
      "gotas",
      "cruel",
      "metas",
      "vease",
      "rumor",
      "casco",
      "celda",
      "fumar",
      "vacia",
      "litro",
      "ondas",
      "nobel",
      "manda",
      "aldea",
      "locos",
      "gases",
      "quede",
      "salga",
      "smith",
      "usado",
      "digno",
      "marco",
      "placa",
      "costo",
      "aereo",
      "cenar",
      "traia",
      "bruto",
      "lleve",
      "trago",
      "papas",
      "sabio",
      "rusos",
      "pluma",
      "risas",
      "crean",
      "hablo",
      "opina",
      "debes",
      "asume",
      "grano",
      "pulso",
      "fatal",
      "gafas",
      "vende",
      "lagos",
      "tirar",
      "abria",
      "firmo",
      "naval",
      "digna",
      "amado",
      "aguda",
      "varon",
      "ropas",
      "tunel",
      "circo",
      "natal",
      "queja",
      "fibra",
      "sello",
      "causo",
      "vacas",
      "rompe",
      "darme",
      "coger",
      "verme",
      "falda",
      "autos",
      "ocupo",
      "pardo",
      "ceder",
      "canta",
      "celos",
      "cobra",
      "corea",
      "saint",
      "varia",
      "envio",
      "rubia",
      "furia",
      "lidia",
      "trozo",
      "coral",
      "talla",
      "viste",
      "bonos",
      "duran",
      "pagan",
      "hondo",
      "judio",
      "vivas",
      "freud",
      "abren",
      "rivas",
      "ariel",
      "dadas",
      "gallo",
      "sobra",
      "salta",
      "fauna",
      "duele",
      "grita",
      "joyas",
      "barça",
      "dados",
      "suyas",
      "tardo",
      "cogio",
      "sucia",
      "altar",
      "venus",
      "henry",
      "flora",
      "ponce",
      "urnas",
      "marin",
      "roque",
      "rutas",
      "times",
      "macho",
      "rasgo",
      "frank",
      "marti",
      "lazos",
      "saldo",
      "acabo",
      "vengo",
      "aroma",
      "plomo",
      "cesar",
      "tonto",
      "botas",
      "globo",
      "formo",
      "sutil",
      "viera",
      "veras",
      "anton",
      "trono",
      "digas",
      "veras",
      "almas",
      "cruce",
      "movia",
      "orina",
      "river",
      "tenor",
      "palos",
      "pelos",
      "pares",
      "gusto",
      "marte",
      "naves",
      "pongo",
      "viajo",
      "sumar",
      "eleva",
      "sales",
      "roman",
      "lorca",
      "ayudo",
      "gorda",
      "cesid",
      "raton",
      "harto",
      "llamo",
      "secas",
      "jones",
      "secos",
      "sirva",
      "huida",
      "jerez",
      "cueva",
      "sexta",
      "suman",
      "velez",
      "damos",
      "verso",
      "hagas",
      "hable",
      "sucio",
      "verle",
      "dario",
      "fijos",
      "lavar",
      "viaja",
      "citas",
      "mitos",
      "cajon",
      "jamon",
      "gatos",
      "linda",
      "vejez",
      "dejen",
      "quito",
      "lapso",
      "paula",
      "ancha",
      "tonos",
      "velas",
      "emite",
      "ciega",
      "rioja",
      "ratos",
      "actuo",
      "faena",
      "feroz",
      "bruno",
      "movio",
      "acude",
      "girar",
      "sainz",
      "daran",
      "ficha",
      "apoyo",
      "pinta",
      "belga",
      "cruzo",
      "multa",
      "camas",
      "colmo",
      "bares",
      "cobro",
      "acoso",
      "tomas",
      "prosa",
      "haiti",
      "ruina",
      "besos",
      "susto",
      "manta",
      "diosa",
      "anoto",
      "tropa",
      "yendo",
      "latin",
      "cruza",
      "frias",
      "valia",
      "acera",
      "digan",
      "tinta",
      "mares",
      "celta",
      "miras",
      "album",
      "rocio",
      "tazas",
      "extra",
      "opone",
      "porta",
      "arcos",
      "temia",
      "gozar",
      "aleja",
      "frios",
      "andan",
      "ritos",
      "telon",
      "toreo",
      "mapas",
      "tokio",
      "bolso",
      "honda",
      "llora",
      "quedo",
      "veran",
      "calla",
      "salto",
      "nomas",
      "tigre",
      "verte",
      "etico",
      "venas",
      "hilos",
      "manga",
      "fabio",
      "paulo",
      "yemas",
      "envia",
      "traen",
      "elias",
      "pinos",
      "corto",
      "manto",
      "mutua",
      "burla",
      "mixta",
      "optar",
      "becas",
      "saenz",
      "salvo",
      "curar",
      "fundo",
      "soria",
      "tacto",
      "nacen",
      "freno",
      "sigan",
      "tango",
      "ratas",
      "brown",
      "texas",
      "molde",
      "balas",
      "himno",
      "sodio",
      "lleno",
      "razas",
      "ligas",
      "mejia",
      "solto",
      "bodas",
      "andes",
      "ricas",
      "cauce",
      "gijon",
      "ayala",
      "sexos",
      "turco",
      "alude",
      "aulas",
      "pekin",
      "falto",
      "focos",
      "puros",
      "aguja",
      "dudar",
      "galan",
      "guapa",
      "otero",
      "brisa",
      "leves",
      "senos",
      "lindo",
      "finas",
      "tribu",
      "vicio",
      "usaba",
      "cerco",
      "suizo",
      "boxeo",
      "huele",
      "renfe",
      "jaula",
      "louis",
      "nacho",
      "celia",
      "temen",
      "tibia",
      "bando",
      "mutuo",
      "recto",
      "anexo",
      "cejas",
      "rodar",
      "cabia",
      "tumor",
      "flaco",
      "narra",
      "curas",
      "telas",
      "botin",
      "debut",
      "temer",
      "durar",
      "parra",
      "subia",
      "ganan",
      "cocer",
      "mitin",
      "funda",
      "berta",
      "raras",
      "trapo",
      "marea",
      "sabra",
      "guapo",
      "avila",
      "helms",
      "torpe",
      "resta",
      "davis",
      "hable",
      "opino",
      "veria",
      "asoma",
      "podre",
      "quema",
      "fugaz",
      "guias",
      "senda",
      "comen",
      "elige",
      "vayas",
      "betis",
      "robar",
      "lunar",
      "xunta",
      "entre",
      "peste",
      "tonta",
      "llame",
      "lapiz",
      "mafia",
      "segui",
      "salva",
      "situo",
      "lucio",
      "cedio",
      "beach",
      "films",
      "jabon",
      "ruedo",
      "tubos",
      "ruego",
      "belen",
      "pasto",
      "bolas",
      "grand",
      "pugna",
      "roger",
      "amada",
      "tomen",
      "bacon",
      "sordo",
      "amaba"
    ];

List<String> get keyboardRows => ['qwertyuiop', 'asdfghjkl', 'zxcvbnm'];
Database db = Database();

class GameState extends ChangeNotifier {
  GameState() {
    var now = DateTime.now();
    var diffInDays = now.difference(DateTime(now.year, 1, 1, 0, 0)).inDays;
    word = dictionary[diffInDays % dictionary.length];
  }

  static const int tries = 6;
  late String word;

  List<String> guesses = [];
  String currentGuess = "";
  bool isFinished = false;
  Set<String> usedLetters = <String>{};
  Set<String> usedMatched = <String>{};
  Set<String> usedMatchedPosition = <String>{};

  Set<String> events = <String>{};
  List<String> messages = [];
  bool isAnimating = false;

  List<LetterState> validateWord(String guess) {
    var g = guess.split('').toList();
    if (guess.isEmpty) {
      return word.split('').map<LetterState>((e) => LetterState.none).toList();
    }
    // by default missed
    List<LetterState> result =
        word.split('').map<LetterState>((e) => LetterState.missed).toList();

    var idx = 0;
    // Match those in the expected position
    for (var c in g) {
      if (c == word[idx]) {
        result[idx] = LetterState.positionMatch;
        // set to something which is not a letter
        // to avoid remarking as yellow below
        g[idx] = '0';
      }
      idx++;
    }
    // match those who are not in the expected position but exist
    idx = 0;
    for (var c in result) {
      if (c != LetterState.positionMatch) {
        var guessIdx = 0;
        for (var l in g) {
          if (word[idx] == l) {
            result[guessIdx] = LetterState.match;
            g[guessIdx] = '0';
            // stop checking for the same letter if we found one
            break;
          }
          guessIdx++;
        }
      }
      idx++;
    }

    return result;
  }

  exists(word) {
    return dictionary.contains(word);
  }

  clearEvent(String event) {
    events.remove(event);
  }

  startAnimation(int seconds) {
    isAnimating = true;
    Future.delayed(Duration(seconds: seconds), () {
      isAnimating = false;
      notifyListeners();
    });
  }

  addEvent(String event) {
    events.add(event);
  }

  updateCurrentGuess(String text) {
    if (isFinished || isAnimating) {
      return;
    }
    if (text == "enter") {
      if (currentGuess.length < word.length) {
        Toast.show("Muy corta", duration: Toast.lengthLong, gravity: Toast.top);
        addEvent("SHAKE-CURRENT");
        startAnimation(2);
        notifyListeners();
        return;
      } else {
        addGuess();
      }
    } else if (text == "delete") {
      if (currentGuess.isNotEmpty) {
        currentGuess = currentGuess.substring(0, currentGuess.length - 1);
      }
      notifyListeners();
    } else if (currentGuess.length < word.length &&
        keyboardRows.indexWhere((element) => element.contains(text)) >= 0) {
      currentGuess += text;
      notifyListeners();
    }
  }

  addGuess() {
    if (isAnimating) {
      return;
    }

    if (exists(currentGuess)) {
      guesses.add(currentGuess);
      var lstate = validateWord(currentGuess);
      var idx = 0;
      var won = true;
      while (idx < lstate.length) {
        if (lstate[idx] == LetterState.positionMatch) {
          usedMatchedPosition.add(currentGuess[idx]);
        } else if (lstate[idx] == LetterState.match) {
          usedMatched.add(currentGuess[idx]);
          won = false;
        } else {
          usedLetters.add(currentGuess[idx]);
          won = false;
        }
        idx++;
      }

      if (won || guesses.length == GameState.tries) {
        Toast.show(won ? "FANTASTICO!" : word.toUpperCase(),
            duration: Toast.lengthLong, gravity: Toast.top);

        db.updateGame(guesses.length, won);
        isFinished = true;
      }
      currentGuess = "";
      addEvent("ROTATE-PREV");
      startAnimation(4);
    } else {
      Toast.show("No existe en el diccionario",
          duration: Toast.lengthLong, gravity: Toast.top);
      addEvent("SHAKE-CURRENT");
      startAnimation(1);
    }

    notifyListeners();
  }
}
